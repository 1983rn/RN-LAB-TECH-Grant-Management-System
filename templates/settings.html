{% extends "base.html" %}

{% block title %}System Settings - Grant Management System{% endblock %}

{% block content %}
<div class="max-w-full">
    <!-- Financial Year Section -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <div class="flex items-center justify-between mb-6 pb-4 border-b">
            <div>
                <h2 class="text-2xl font-bold text-gray-900">Financial Year</h2>
                <p class="text-gray-500 text-sm">Select the active financial year for the system.</p>
            </div>
            <i class="fas fa-calendar-alt text-4xl text-gray-200"></i>
        </div>

        <form method="POST" action="{{ url_for('settings') }}" class="max-w-md" id="financialYearForm">
            <input type="hidden" name="form_type" value="financial_year">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Active Financial Year</label>
                    <select name="financialYear" required onchange="changeFinancialYear()"
                        class="w-full px-4 py-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-lg font-semibold">
                        <option value="2026-2027" {% if financial_year=="2026-2027" %}selected{% endif %}>2026-2027</option>
                        <option value="2027-2028" {% if financial_year=="2027-2028" %}selected{% endif %}>2027-2028</option>
                        <option value="2028-2029" {% if financial_year=="2028-2029" %}selected{% endif %}>2028-2029</option>
                        <option value="2029-2030" {% if financial_year=="2029-2030" %}selected{% endif %}>2029-2030</option>
                        <option value="2030-2031" {% if financial_year=="2030-2031" %}selected{% endif %}>2030-2031</option>
                    </select>
                    <p class="mt-2 text-xs text-gray-500">This year will be used across all pages and reports.</p>
                </div>
            </div>
        </form>

        <script>
        function changeFinancialYear() {
            sessionStorage.setItem('yearChanged', 'true');
            document.getElementById('financialYearForm').submit();
        }

        if (sessionStorage.getItem('yearChanged') === 'true') {
            sessionStorage.removeItem('yearChanged');
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-blue-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            notification.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Financial year updated. All pages will reflect the new year.';
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }
        </script>
    </div>

    <!-- Official Signatures Section -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex items-center justify-between mb-8 pb-4 border-b">
            <div>
                <h2 class="text-2xl font-bold text-gray-900">Official Signatures & Role Settings</h2>
                <p class="text-gray-500 text-sm">Update the names, school details, and grant amount that appear on documents.</p>
            </div>
            <i class="fas fa-cog text-4xl text-gray-200"></i>
        </div>

        {% if success %}
        <div
            class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6 rounded shadow-sm flex justify-between items-center">
            <div class="flex items-center">
                <i class="fas fa-check-circle mr-3"></i>
                <span>Settings saved successfully! These details will now appear on all new and existing vouchers.</span>
            </div>
            <button onclick="this.parentElement.remove()" class="text-green-700 hover:text-green-900">
                <i class="fas fa-times"></i>
            </button>
        </div>
        {% endif %}

        <form method="POST" action="{{ url_for('settings') }}" class="space-y-8">
            <input type="hidden" name="form_type" value="signatures">
            
            <!-- Total Grant -->
            <div class="p-4 bg-gray-50 rounded-lg">
                <h3 class="font-semibold text-gray-700 mb-4 flex items-center">
                    <i class="fas fa-money-bill-wave mr-2 text-green-500"></i> Total Grant (MWK)
                </h3>
                <div class="max-w-md">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Total Grant for {{ financial_year }}</label>
                    <input type="number" name="totalGrant" value="{{ total_grant }}" step="0.01" min="0"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                        placeholder="0.00">
                    <p class="mt-2 text-xs text-gray-500">This amount will be used across all pages and calculations.</p>
                </div>
            </div>
            
            <!-- School Details -->
            <div class="p-4 bg-gray-50 rounded-lg">
                <h3 class="font-semibold text-gray-700 mb-4 flex items-center">
                    <i class="fas fa-school mr-2 text-purple-500"></i> School Details
                </h3>
                <div class="max-w-md space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">School Name</label>
                        <input type="text" name="schoolName" value="{{ settings.schoolName }}"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                            placeholder="e.g. NANJATI CDSS">
                        <p class="mt-2 text-xs text-gray-500">This name will appear on Budget Allocation and reports.</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">School Address</label>
                        <input type="text" name="schoolAddress" value="{{ settings.schoolAddress }}"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                            placeholder="e.g. P.O. Box 123, Lilongwe, Malawi">
                        <p class="mt-2 text-xs text-gray-500">This address will appear on GP10 Payment Vouchers.</p>
                    </div>
                </div>
            </div>
            
            <!-- Vouchering Officers -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-4 bg-gray-50 rounded-lg">
                <div class="md:col-span-2">
                    <h3 class="font-semibold text-gray-700 flex items-center">
                        <i class="fas fa-pen-fancy mr-2 text-blue-500"></i> Vouchering Personnel
                    </h3>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Compiled By (Name)</label>
                    <input type="text" name="compiledBy" value="{{ settings.compiledBy }}" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                        placeholder="e.g. John Phiri">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Entered in Vote Book by (Name)</label>
                    <input type="text" name="enteredBy" value="{{ settings.enteredBy }}" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                        placeholder="e.g. Mary Banda">
                </div>
            </div>

            <!-- Authorization Details -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-4 bg-gray-50 rounded-lg">
                <div class="md:col-span-2">
                    <h3 class="font-semibold text-gray-700 flex items-center">
                        <i class="fas fa-check-double mr-2 text-green-500"></i> Authorization Officers
                    </h3>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Authorizing Officer (Name)</label>
                    <input type="text" name="authorizingOfficer" value="{{ settings.authorizingOfficer }}" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                        placeholder="e.g. Samuel Mbeki">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Appointment / Role (Authorizing)</label>
                    <input type="text" name="authorizingAppointment" value="{{ settings.authorizingAppointment }}"
                        required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                        placeholder="e.g. Head Teacher">
                </div>
                <div class="pt-4 md:col-span-2 border-t border-gray-200 mt-2"></div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Counter Sign (Name)</label>
                    <input type="text" name="counterSign" value="{{ settings.counterSign }}" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                        placeholder="e.g. Dr. Jane Doe">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Appointment / Role (Counter
                        Sign)</label>
                    <input type="text" name="counterAppointment" value="{{ settings.counterAppointment }}" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                        placeholder="e.g. PEA / Accountant">
                </div>
            </div>

            <!-- Institutional Info -->
            <div class="p-4 bg-gray-50 rounded-lg">
                <h3 class="font-semibold text-gray-700 mb-4 flex items-center">
                    <i class="fas fa-university mr-2 text-purple-500"></i> Institutional Context
                </h3>
                <div class="max-w-md">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Ministry / Department</label>
                    <input type="text" name="ministry" value="{{ settings.ministry }}" required
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"
                        placeholder="e.g. Education">
                </div>
            </div>

            <div class="flex justify-end pt-6 border-t">
                <button type="submit"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-md font-bold shadow-lg transition-all transform hover:scale-105">
                    <i class="fas fa-save mr-2"></i> Save Settings
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}